<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>My Messages</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
</head>
<body>
<div class="container mt-4">
    <h2>📨 Your Messages</h2>

    <div th:if="${#lists.isEmpty(userMessages)}">
        <p class="alert alert-info">You haven’t sent any messages yet.</p>
        <a class="btn btn-primary mt-3" th:href="@{/contact}">Send a New Message</a>
    </div>

    <div th:each="msg : ${userMessages}" class="card mb-4">
        <div class="card-header text-muted">
            Sent at: <span th:text="${#dates.format(msg.sentAt, 'yyyy-MM-dd HH:mm')}"></span>
        </div>
        <div class="card-body">
            <!-- Original message -->
            <p><strong>You:</strong></p>
            <p class="bg-light p-2 rounded" th:text="${msg.content}">Your message</p>

            <!-- Admin reply -->
            <div th:if="${msg.reply != null}">
                <p class="mt-3"><strong>Admin:</strong></p>
                <p class="bg-white p-2 border rounded" th:text="${msg.reply}">Admin reply</p>
            </div>

            <!-- Customer follow-up -->
            <div th:if="${msg.customerFollowUp != null}">
                <p class="mt-3"><strong>You (Follow-Up):</strong></p>
                <p class="bg-light p-2 border rounded" th:text="${msg.customerFollowUp}">Your follow-up</p>
            </div>

            <!-- Reply form (only if admin replied and customer hasn't replied back yet) -->
            <div th:if="${msg.reply != null and msg.customerFollowUp == null}" class="mt-3">
                <form th:action="@{/my-messages/{id}/reply(id=${msg.id})}" method="post">
                    <label class="form-label">Your Reply:</label>
                    <textarea name="followUp" rows="3" class="form-control" required></textarea>
                    <button class="btn btn-outline-primary btn-sm mt-2" type="submit">Send Reply</button>
                </form>
            </div>
        </div>
    </div>

    <a class="btn btn-secondary mt-4" th:href="@{/contact}">✉️ Send Another Message</a>
</div>
</body>
</html>
